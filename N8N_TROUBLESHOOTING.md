# n8n トラブルシューティングガイド

## unpkg.comがブロックされている警告について

### 問題
n8nにアクセスしようとした際に、以下のような警告が表示される：
```
unpkg.com はブロックされています！
Phantom はこの Web サイトにあり、使用するのは危険だと判断しました。
```

### 原因
- **unpkg.com**は、npmパッケージをCDN経由で提供する信頼性の高いサービスです
- n8nが一部のJavaScriptライブラリをunpkg.comから読み込もうとしているため
- セキュリティソフト（Phantom）が誤検知している可能性が高い

### 対処法

#### 方法1: 警告を無視して進める（推奨）
1. 「警告を無視して unpkg.com に移動します」をクリック
2. unpkg.comは安全なCDNなので、問題なく使用できます
3. n8nの機能は正常に動作します

**理由**:
- unpkg.comは公式のnpm CDNで、多くのプロジェクトで使用されています
- n8n公式でも使用されているため、安全です

#### 方法2: Phantomの設定でunpkg.comを許可リストに追加
1. Phantomの設定を開く
2. 「許可リスト」または「ホワイトリスト」に追加
3. `unpkg.com` を追加
4. ブラウザを再起動

#### 方法3: ブラウザのセキュリティ設定を一時的に緩和（開発環境のみ）
1. ブラウザの設定でセキュリティレベルを下げる
2. **注意**: 本番環境では推奨しません

---

## その他のよくある問題

### n8nが起動しない

#### 症状
- Railwayでデプロイしたが、n8nにアクセスできない
- エラーログが表示される

#### 対処法
1. **環境変数を確認**
   - `N8N_HOST=0.0.0.0` が設定されているか
   - `N8N_PORT=5678` が設定されているか
   - `N8N_PROTOCOL=https` が設定されているか

2. **Railwayのログを確認**
   - Railwayダッシュボードで「Deployments」→「View Logs」
   - エラーメッセージを確認

3. **サービスを再起動**
   - 「Deployments」タブで「Redeploy」をクリック

---

### Meta API接続エラー

#### 症状
- Meta APIノードでエラーが発生する
- 「Invalid access token」などのエラー

#### 対処法
1. **アクセストークンの確認**
   - トークンが有効か確認（60日で期限切れ）
   - 新しいトークンを取得して更新

2. **Metaアプリの権限確認**
   - 「Marketing API」が有効になっているか
   - 必要な権限が付与されているか

3. **アカウントIDの確認**
   - 正しい広告アカウントIDを使用しているか

---

### 本システムAPIへの送信エラー

#### 症状
- HTTP Requestノードでエラーが発生する
- 「401 Unauthorized」などのエラー

#### 対処法
1. **JWTトークンの確認**
   - トークンが有効か確認（30分で期限切れの可能性）
   - 環境変数 `JWT_TOKEN` が正しく設定されているか

2. **API URLの確認**
   - バックエンドAPIのURLが正しいか
   - HTTPSを使用しているか

3. **CSVフォーマットの確認**
   - 必須カラムが含まれているか
   - データ形式が正しいか

---

### データが取得できない

#### 症状
- Meta APIからデータが取得できない
- 空の結果が返ってくる

#### 対処法
1. **時間範囲の確認**
   - 正しい日付範囲を指定しているか
   - 過去のデータが存在するか

2. **フィールドの確認**
   - 必要なフィールドが選択されているか
   - フィールド名が正しいか

3. **アカウントの確認**
   - 広告アカウントにデータが存在するか
   - キャンペーンがアクティブか

---

### ワークフローが実行されない

#### 症状
- スケジュールが設定されているが実行されない
- 手動実行でもエラーが発生する

#### 対処法
1. **ワークフローが有効化されているか確認**
   - 右上のトグルスイッチが「Active」になっているか

2. **スケジュール設定の確認**
   - 正しい時間が設定されているか
   - タイムゾーンが正しいか

3. **ログを確認**
   - n8nの「Executions」タブで実行履歴を確認
   - エラーメッセージを確認

---

## パフォーマンスの問題

### ワークフローが遅い

#### 対処法
1. **不要なノードを削除**
2. **データ量を制限**（必要に応じて）
3. **PostgreSQLを使用**（SQLiteより高速）

---

## セキュリティの問題

### 認証が機能しない

#### 対処法
1. **環境変数の確認**
   - `N8N_BASIC_AUTH_ACTIVE=true` が設定されているか
   - ユーザー名とパスワードが正しいか

2. **サービスを再起動**
   - 環境変数を変更した後は再起動が必要

---

## ログの確認方法

### Railwayでのログ確認
1. Railwayダッシュボードにアクセス
2. プロジェクトを選択
3. n8nサービスを選択
4. 「Deployments」タブで「View Logs」をクリック

### n8nでのログ確認
1. n8nダッシュボードにアクセス
2. 「Executions」タブを開く
3. 実行履歴を確認
4. エラーが発生した実行をクリックして詳細を確認

---

## サポート

問題が解決しない場合は、以下を参照してください：
- [n8n公式ドキュメント](https://docs.n8n.io/)
- [n8n GitHub Issues](https://github.com/n8n-io/n8n/issues)
- [Railwayドキュメント](https://docs.railway.app/)

