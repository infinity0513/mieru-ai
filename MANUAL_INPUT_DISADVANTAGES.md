# 総コンバージョン価値の手動入力によるデメリット分析

## 現状の実装

「総コンバージョン価値」は現在、以下のように自動計算されています：

```typescript
const totalValue = current.reduce((acc, curr) => acc + curr.conversion_value, 0);
```

- `filteredData`（フィルタリングされたデータ）から各レコードの`conversion_value`を合計
- 日付範囲やキャンペーン選択に応じて自動的に再計算される

## 手動入力可能にした場合のデメリット

### 1. **データの整合性が失われる**

#### 問題点
- 手動入力値と実際のデータの合計が一致しなくなる
- データソース（CSV/API）とダッシュボードの表示値に不整合が発生

#### 具体例
- 実際のデータ合計: ¥1,000,000
- 手動入力値: ¥1,200,000
- → 200,000円の差が発生し、どちらが正しいか不明確になる

---

### 2. **ROAS（広告費用対効果）の計算が不正確になる**

#### 問題点
ROASは以下の式で計算されています：
```typescript
const avgRoas = totalCost > 0 ? (totalValue / totalCost * 100) : 0;
```

手動入力値を使用すると：
- 実際のROASと表示されるROASが異なる
- 意思決定に誤った情報が使われる可能性がある

#### 具体例
- 実際の総コンバージョン価値: ¥1,000,000
- 総費用: ¥500,000
- **実際のROAS**: 200%

- 手動入力値: ¥1,200,000
- 総費用: ¥500,000
- **表示されるROAS**: 240%（誤った値）

---

### 3. **日付範囲やキャンペーン選択時の自動更新ができない**

#### 問題点
現在は日付範囲やキャンペーンを変更すると、自動的に再計算されますが：
- 手動入力値は固定値のまま
- フィルタ変更時に手動で再入力が必要
- ユーザーが更新を忘れる可能性がある

#### 具体例
1. 「過去7日間」で手動入力: ¥500,000
2. 「過去30日間」に変更
3. → 手動入力値（¥500,000）がそのまま表示される（実際は¥2,000,000であるべき）

---

### 4. **トレンド表示が意味をなさなくなる**

#### 問題点
現在、`cvValueTrend`が表示されていますが：
- 手動入力値は固定値のため、トレンド計算ができない
- 前回値との比較ができない
- 増減率の表示が不正確になる

---

### 5. **他の指標との整合性が取れなくなる**

#### 問題点
以下の指標は「総コンバージョン価値」と関連しています：
- **ROAS**: `totalValue / totalCost * 100`
- **CPA**: `totalCost / totalConversions`（コンバージョン数は自動計算）
- **CVR**: `totalConversions / totalClicks * 100`

手動入力値を使うと：
- ROASは手動入力値ベースで計算される
- しかし、コンバージョン数は自動計算のまま
- → 指標間の整合性が失われる

#### 具体例
- 手動入力の総コンバージョン価値: ¥1,200,000（実際は¥1,000,000）
- 自動計算のコンバージョン数: 100件
- 自動計算の総費用: ¥500,000

→ ROASは240%と表示されるが、実際の1コンバージョンあたりの価値（¥10,000）と表示値（¥12,000）が一致しない

---

### 6. **データの追跡可能性が失われる**

#### 問題点
- 手動入力値の根拠が不明確になる
- なぜその値にしたのか、いつ変更したのかが記録されない
- 監査や検証が困難になる

---

### 7. **複数ユーザー間での不整合**

#### 問題点
- ユーザーAが手動入力: ¥1,200,000
- ユーザーBが同じ画面を見る: 自動計算値¥1,000,000
- → 同じデータなのに異なる値が表示される

---

### 8. **データ更新時の問題**

#### 問題点
- CSVを再アップロードした場合
- 手動入力値が残るか、自動計算値に戻るか？
- どちらを優先するか判断が必要

---

### 9. **エクスポート・レポート機能との不整合**

#### 問題点
- ダッシュボードでは手動入力値
- エクスポートしたCSV/レポートでは自動計算値
- → 同じ期間のデータなのに値が異なる

---

### 10. **バグや誤入力のリスク**

#### 問題点
- タイプミス（例: ¥1,000,000 → ¥10,000,000）
- 単位の間違い（例: 円をドルで入力）
- 負の値の入力
- 数値以外の文字入力

---

## 推奨される代替案

### 案1: **補正値（オフセット）の追加**
手動入力ではなく、「補正値」を追加する方式：
- 自動計算値: ¥1,000,000
- 補正値: +¥200,000
- 表示値: ¥1,200,000

**メリット:**
- 元のデータとの関係が明確
- 補正の理由を記録できる
- データ更新時も補正値を維持できる

### 案2: **メモ・注釈機能**
手動入力ではなく、値に注釈を追加：
- 自動計算値: ¥1,000,000
- 注釈: 「実際の売上は¥1,200,000（手動集計）」

**メリット:**
- データの整合性を保てる
- 補足情報を記録できる

### 案3: **手動入力モードの明確な切り替え**
- 「自動計算モード」と「手動入力モード」を明確に分ける
- 手動入力モード時は、他の自動計算指標を無効化または警告表示

**メリット:**
- ユーザーが現在のモードを理解できる
- 誤用を防げる

---

## 結論

手動入力機能を追加する場合は、以下の点を考慮する必要があります：

1. **データの整合性をどう保つか**
2. **他の指標（ROAS等）への影響をどう処理するか**
3. **日付範囲変更時の動作をどうするか**
4. **手動入力値の保存・復元方法**
5. **複数ユーザー間での同期方法**

最も安全な方法は、**補正値（オフセット）方式**を採用することです。これにより、元のデータとの関係を保ちながら、手動での調整も可能になります。



